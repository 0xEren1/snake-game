<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake on Base</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0b0b0b;
  color: #fff;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

#container {
  width: 360px;
  text-align: center;
  position: relative;
}

canvas {
  background: #111;
  display: none;
}

#score {
  position: absolute;
  top: 10px;
  right: 10px;
  display: none;
}

.overlay {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,.85);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

button {
  padding: 12px 24px;
  font-size: 16px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
}

#controls {
  display: none;
  margin-top: 10px;
}

.pad {
  display: grid;
  grid-template-columns: 60px 60px 60px;
  grid-template-rows: 60px 60px 60px;
  gap: 6px;
  justify-content: center;
}

.ctrl {
  background: #000;
  color: #fff;
  font-size: 22px;
  border-radius: 10px;
}
</style>
</head>

<body>
<div id="container">
  <h2>üêç Snake on Base</h2>
  <div>A simple onchain game built on Base.</div>

  <div id="score">SCORE: 0</div>
  <canvas id="game" width="360" height="360"></canvas>

  <div id="wallet" class="overlay">
    <button id="connectBtn">CONNECT WALLET</button>
  </div>

  <div id="menu" class="overlay" style="display:none;">
    <button onclick="startGame()">PLAY</button>
  </div>

  <div id="gameOver" class="overlay" style="display:none;">
    <h2>GAME OVER</h2>
    <button onclick="startGame()">PLAY AGAIN</button>
  </div>

  <div id="controls">
    <div class="pad">
      <div></div><button class="ctrl" onclick="setDir(0,-1)">‚¨ÜÔ∏è</button><div></div>
      <button class="ctrl" onclick="setDir(-1,0)">‚¨ÖÔ∏è</button><div></div><button class="ctrl" onclick="setDir(1,0)">‚û°Ô∏è</button>
      <div></div><button class="ctrl" onclick="setDir(0,1)">‚¨áÔ∏è</button><div></div>
    </div>
  </div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const grid = 18;
const size = canvas.width / grid;

let snake, food, dx, dy, score, loopId;
let walletConnected = false;

document.getElementById("connectBtn").onclick = async () => {
  if (typeof window.ethereum === "undefined") {
    alert("MetaMask yok");
    return;
  }

  try {
    await window.ethereum.request({ method: "eth_requestAccounts" });
    walletConnected = true;
    document.getElementById("wallet").style.display = "none";
    document.getElementById("menu").style.display = "flex";
  } catch {
    alert("Wallet baƒülantƒ±sƒ± reddedildi");
  }
};

function startGame() {
  if (!walletConnected) return;

  document.getElementById("menu").style.display = "none";
  document.getElementById("gameOver").style.display = "none";
  canvas.style.display = "block";
  document.getElementById("score").style.display = "block";
  document.getElementById("controls").style.display = "block";

  snake = [{x:9,y:9}];
  dx = 1; dy = 0;
  score = 0;
  spawnFood();
  updateScore();

  clearInterval(loopId);
  loopId = setInterval(loop, 260);
}

function loop() {
  const head = {x: snake[0].x + dx, y: snake[0].y + dy};

  if (
    head.x < 0 || head.y < 0 ||
    head.x >= grid || head.y >= grid ||
    snake.some(s => s.x === head.x && s.y === head.y)
  ) return endGame();

  snake.unshift(head);

  if (head.x === food.x && head.y === food.y) {
    score++;
    spawnFood();
    updateScore();
  } else snake.pop();

  draw();
}

function draw() {
  ctx.fillStyle = "#111";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.strokeStyle = "#1a1a1a";
  for(let i=0;i<grid;i++){
    ctx.beginPath();
    ctx.moveTo(i*size,0);
    ctx.lineTo(i*size,canvas.height);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(0,i*size);
    ctx.lineTo(canvas.width,i*size);
    ctx.stroke();
  }

  ctx.fillStyle = "#fff";
  snake.forEach(s => ctx.fillRect(s.x*size, s.y*size, size-1, size-1));
  ctx.fillRect(food.x*size, food.y*size, size-1, size-1);
}

function spawnFood() {
  food = {x: Math.floor(Math.random()*grid), y: Math.floor(Math.random()*grid)};
}

function updateScore() {
  document.getElementById("score").innerText = "SCORE: " + score;
}

function endGame() {
  clearInterval(loopId);
  document.getElementById("gameOver").style.display = "flex";
}

function setDir(x,y) {
  if (x !== -dx || y !== -dy) { dx = x; dy = y; }
}

document.addEventListener("keydown", e => {
  if (e.key==="ArrowUp") setDir(0,-1);
  if (e.key==="ArrowDown") setDir(0,1);
  if (e.key==="ArrowLeft") setDir(-1,0);
  if (e.key==="ArrowRight") setDir(1,0);
});
</script>
</body>
</html>
