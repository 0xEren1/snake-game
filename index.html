<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Snake on Base</title>

<script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #0b0b0b;
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  #container {
    width: 360px;
    text-align: center;
    position: relative;
  }

  h1 {
    margin: 10px 0 4px;
  }

  .subtitle {
    font-size: 14px;
    opacity: 0.8;
    margin-bottom: 10px;
  }

  canvas {
    background: #111;
    display: none;
  }

  #score {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 14px;
    display: none;
  }

  .overlay {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.75);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  button {
    padding: 12px 24px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }

  /* D-PAD */
  #controls {
    margin-top: 10px;
    display: none;
  }

  .row {
    display: flex;
    justify-content: center;
  }

  .ctrl {
    width: 60px;
    height: 60px;
    margin: 4px;
    font-size: 24px;
    border-radius: 12px;
    background: #1a1a1a;
    color: #fff;
  }
</style>
</head>

<body>
<div id="container">
  <h1>üêç Snake on Base</h1>
  <div class="subtitle">A simple onchain game built on Base.</div>

  <div id="score">SCORE: 0</div>
  <canvas id="game" width="360" height="360"></canvas>

  <div id="menu" class="overlay">
    <button onclick="startGame()">PLAY</button>
  </div>

  <div id="gameOver" class="overlay" style="display:none;">
    <h2>GAME OVER</h2>
    <button onclick="startGame()">PLAY AGAIN</button>
  </div>

  <div id="controls">
    <div class="row">
      <button class="ctrl" onclick="setDir(0,-1)">‚¨ÜÔ∏è</button>
    </div>
    <div class="row">
      <button class="ctrl" onclick="setDir(-1,0)">‚¨ÖÔ∏è</button>
      <button class="ctrl" onclick="setDir(1,0)">‚û°Ô∏è</button>
    </div>
    <div class="row">
      <button class="ctrl" onclick="setDir(0,1)">‚¨áÔ∏è</button>
    </div>
  </div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const gridSize = 18;
const tile = canvas.width / gridSize;

let snake, food, dx, dy, score, interval, running;

function startGame() {
  document.getElementById("menu").style.display = "none";
  document.getElementById("gameOver").style.display = "none";
  canvas.style.display = "block";
  document.getElementById("score").style.display = "block";
  document.getElementById("controls").style.display = "block";

  snake = [{x:9, y:9}];
  dx = 1; dy = 0;
  score = 0;
  updateScore();
  spawnFood();
  running = true;

  clearInterval(interval);
  interval = setInterval(loop, 200); // YAVA≈ûLATILDI
}

function updateScore() {
  document.getElementById("score").innerText = "SCORE: " + score;
}

function spawnFood() {
  food = {
    x: Math.floor(Math.random()*gridSize),
    y: Math.floor(Math.random()*gridSize)
  };
}

function loop() {
  if (!running) return;

  const head = {x: snake[0].x + dx, y: snake[0].y + dy};

  if (
    head.x < 0 || head.y < 0 ||
    head.x >= gridSize || head.y >= gridSize ||
    snake.some(s => s.x === head.x && s.y === head.y)
  ) {
    gameOver();
    return;
  }

  snake.unshift(head);

  if (head.x === food.x && head.y === food.y) {
    score++;
    updateScore();
    spawnFood();
  } else {
    snake.pop();
  }

  draw();
}

function drawGrid() {
  ctx.strokeStyle = "#1a1a1a";
  for (let i=0;i<gridSize;i++) {
    ctx.beginPath();
    ctx.moveTo(i*tile,0);
    ctx.lineTo(i*tile,canvas.height);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(0,i*tile);
    ctx.lineTo(canvas.width,i*tile);
    ctx.stroke();
  }
}

function draw() {
  ctx.fillStyle = "#111";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  drawGrid();

  ctx.fillStyle = "#fff";
  snake.forEach(s => {
    ctx.fillRect(s.x*tile, s.y*tile, tile-1, tile-1);
  });

  ctx.fillRect(food.x*tile, food.y*tile, tile-1, tile-1);
}

function gameOver() {
  running = false;
  clearInterval(interval);
  document.getElementById("gameOver").style.display = "flex";
}

function setDir(x,y) {
  if (x !== -dx || y !== -dy) {
    dx = x;
    dy = y;
  }
}

document.addEventListener("keydown", e => {
  if (e.key === "ArrowUp") setDir(0,-1);
  if (e.key === "ArrowDown") setDir(0,1);
  if (e.key === "ArrowLeft") setDir(-1,0);
  if (e.key === "ArrowRight") setDir(1,0);
});
</script>
</body>
</html>
