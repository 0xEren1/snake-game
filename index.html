<script>
// ===== GAME =====
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const grid=18;
const size=canvas.width/grid;

let snake,food,dx,dy,loopId;
let speed=300;

// Oyunu başlat
function startGame(){
  document.getElementById("menu").style.display="none";
  canvas.style.display="block";
  document.getElementById("controls").style.display="block";

  snake=[{x:9,y:9}];
  dx=1; dy=0;
  food=spawnFood();

  clearInterval(loopId);
  loopId=setInterval(loop,speed);
}

// Ana oyun döngüsü
function loop(){
  const head={x:snake[0].x+dx,y:snake[0].y+dy};
  if(head.x<0||head.y<0||head.x>=grid||head.y>=grid||
     snake.some(s=>s.x===head.x&&s.y===head.y)){
    clearInterval(loopId);
    alert("Game Over");
    location.reload();
    return;
  }
  snake.unshift(head);
  if(head.x===food.x&&head.y===food.y) food=spawnFood();
  else snake.pop();
  draw();
}

// Çizim
function draw(){
  ctx.fillStyle="#111";
  ctx.fillRect(0,0,360,360);
  ctx.fillStyle="#fff";
  snake.forEach(s=>ctx.fillRect(s.x*size,s.y*size,size-1,size-1));
  ctx.fillRect(food.x*size,food.y*size,size-1,size-1);
}

function spawnFood(){
  return {x:Math.floor(Math.random()*grid),y:Math.floor(Math.random()*grid)};
}

function setDir(x,y){
  if(x!==-dx||y!==-dy){dx=x;dy=y;}
}

// Boost fonksiyonları
function boostOn(){
  clearInterval(loopId);
  loopId=setInterval(loop,120); // boost hızı
}
function boostOff(){
  clearInterval(loopId);
  loopId=setInterval(loop,speed); // normal hız
}

// Klavye kontrolleri
document.addEventListener("keydown", e=>{
  if(e.key==="ArrowUp") setDir(0,-1);
  if(e.key==="ArrowDown") setDir(0,1);
  if(e.key==="ArrowLeft") setDir(-1,0);
  if(e.key==="ArrowRight") setDir(1,0);
  if(e.key===" ") boostOn(); // space ile boost
});

document.addEventListener("keyup", e=>{
  if(e.key===" ") boostOff(); // space bırakılınca normale dön
});
</script>
